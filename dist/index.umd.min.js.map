{"version":3,"file":"index.umd.min.js","sources":["../src/index.ts"],"sourcesContent":["import axios from 'axios';\n\nexport class UndakuSdk {\n  constructor(\n    private instance: string,\n    private token: string = '',\n    private baseUrl: string = 'http://api/undaku.com',\n    private appId?: string,\n    private appSecret?: string,\n    private username?: string,\n    private password?: string,\n  ) {}\n  private async fetchToken() {\n    let response;\n    try {\n      const url = `/api/session`;\n      response = await axios.get(url, {\n        headers: this.getHeaders({}),\n        baseURL: this.baseUrl,\n        params: { appId: this.appId, appSecret: this.appSecret },\n      });\n      return (\n        (response.data &&\n          response.data.data &&\n          response.data.data.freshToken) ||\n        null\n      );\n    } catch (error) {\n      return null;\n    }\n  }\n\n  async getToken() {\n    try {\n      const response = await axios.post(\n        `/api/login`,\n        {\n          username: this.username,\n          password: this.password,\n          instance: this.instance,\n        },\n        {\n          headers: this.getHeaders({}, true),\n          baseURL: this.baseUrl,\n        },\n      );\n      return response.data.createdId;\n    } catch (error) {\n      return null;\n    }\n  }\n\n  async login() {\n    if (this.appId && this.appSecret) {\n      this.token = await this.fetchToken();\n    } else {\n      this.token = await this.getToken();\n    }\n  }\n\n  private getHeaders(\n    customHeaders: any,\n    skipToken = false,\n    instance?: string,\n    token?: string,\n  ) {\n    token = token || this.token;\n    const reqSource = 'Runtime';\n    const defaultHeader: any = { 'request-source': reqSource };\n    defaultHeader['un-origin'] = instance || this.instance;\n    const headers =\n      skipToken || !token || token.length === 0\n        ? { ...defaultHeader, ...customHeaders }\n        : { ...defaultHeader, Authorization: `bearer ${token}` };\n    return headers;\n  }\n\n  async search(\n    form: string,\n    query: any,\n    reportId?: string,\n  ): Promise<SdkResponse<any[]>> {\n    let response = null;\n    const page = query.page || 1;\n    const pageSize = query.pageSize || 1000;\n    let records: any[] = [];\n    try {\n      const url = `/api/search/${form}`;\n      response = await axios.post(url, query, {\n        headers: this.getHeaders({}),\n        baseURL: this.baseUrl,\n      });\n      const searchId = response.data.createdId;\n      const searchPayload: {\n        page: number;\n        reportId?: string;\n        form: string;\n        searchId: string;\n        pageSize: number;\n        splitColumns: boolean;\n      } = {\n        page,\n        pageSize,\n        reportId,\n        form,\n        searchId,\n        splitColumns: true,\n      } as any;\n      const recordsResponse = await axios.get(`/api/search`, {\n        headers: this.getHeaders({}),\n        baseURL: this.baseUrl,\n        params: searchPayload,\n      });\n      records =\n        (recordsResponse.data &&\n          recordsResponse.data.data &&\n          recordsResponse.data.data.records) ||\n        [];\n      return { data: records, error: null };\n    } catch (ex) {\n      return { data: [], error: ex };\n    }\n  }\n\n  async createRecord(\n    form: string,\n    record: Record,\n  ): Promise<SdkResponse<string>> {\n    let response = null;\n    try {\n      const url = `/api/record/${form}`;\n      response = await axios.post(url, record, {\n        headers: this.getHeaders({}),\n        baseURL: this.baseUrl,\n      });\n      return { data: response.data.createdId, error: null };\n    } catch (error) {\n      return { error };\n    }\n  }\n\n  async getRecord(\n    form: string,\n    recordId: string,\n  ): Promise<SdkResponse<Record>> {\n    let response = null;\n    try {\n      const url = `/api/record/${form}/${recordId}`;\n      response = await axios.get(url, {\n        headers: this.getHeaders({}),\n        baseURL: this.baseUrl,\n      });\n      return { data: response.data, error: null };\n    } catch (error) {\n      return { error };\n    }\n  }\n\n  async deleteRecord(\n    form: string,\n    recordId: string,\n  ): Promise<SdkResponse<Record>> {\n    let response = null;\n    try {\n      const url = `/api/record/${form}/${recordId}`;\n      response = await axios.delete(url, {\n        headers: this.getHeaders({}),\n        baseURL: this.baseUrl,\n      });\n      return { data: response.data, error: null };\n    } catch (error) {\n      return { error };\n    }\n  }\n\n  async getRecordCount(form: string, query: any): Promise<number> {\n    //-1=unknownDueToError\n    const records = await this.search(form, query);\n    return records.error ? -1 : (records.data && records.data.length) || 0;\n  }\n\n  async checkIfRecordExist(form: string, query: any): Promise<number> {\n    //1=exist,0=notexist,-1=unknownDueToError\n    const recordLength = await this.getRecordCount(form, query);\n    return recordLength > 0 ? 1 : recordLength < 0 ? -1 : 1;\n  }\n\n  async updateRecord(\n    form: string,\n    record: Record,\n  ): Promise<SdkResponse<string>> {\n    let response = null;\n    if (record.referenceId) delete record.referenceId;\n    if (!record || !record.id) {\n      return { error: 'Record Id Is Missing' };\n    }\n    try {\n      const url = `/api/record/${form}/${record.id}`;\n      response = await axios.put(url, record, {\n        headers: this.getHeaders({}),\n        baseURL: this.baseUrl,\n      });\n      return { data: response.data.createdId, error: null };\n    } catch (error) {\n      return { error };\n    }\n  }\n\n  serializeToQueryString(obj: any, prefix?: string): string {\n    const str = [];\n    let p;\n    for (p in obj) {\n      // eslint-disable-next-line no-prototype-builtins\n      if (obj.hasOwnProperty(p)) {\n        const k = prefix ? prefix + '[' + p + ']' : p;\n        const v = obj[p];\n        str.push(\n          v !== null && typeof v === 'object'\n            ? this.serializeToQueryString(v, k)\n            : encodeURIComponent(k) + '=' + encodeURIComponent(v),\n        );\n      }\n    }\n    return str.join('&');\n  }\n\n  async getReferences(query: {\n    formAlias: string;\n    recordId: string;\n    fieldAlias: string;\n    page: number;\n    pageSize: number;\n    childFields?: string[];\n  }) {\n    let response = null;\n    const paramString = this.serializeToQueryString(query);\n    try {\n      const url = `/api/references?${paramString}`;\n      response = await axios.get(url, {\n        headers: this.getHeaders({}),\n        baseURL: this.baseUrl,\n      });\n      return { data: response.data && response.data.data.records, error: null };\n    } catch (error) {\n      return { error };\n    }\n  }\n\n  async fetchSubInstances(): Promise<SdkResponse<SubInstancesInfoModel[]>> {\n    let response = null;\n    try {\n      const url = `/api/sub/${this.instance}`;\n      response = await axios.get(url, {\n        headers: this.getHeaders({}),\n        baseURL: this.baseUrl,\n      });\n      return { data: (response.data && response.data.data) || [], error: null };\n    } catch (error) {\n      return { error };\n    }\n  }\n}\n\nexport interface SdkResponse<T> {\n  data?: T;\n  error?: any;\n  message?: any;\n}\n\nexport interface Record {\n  id?: string;\n  form: string;\n  currentLayoutId?: string;\n  currentWFNodeId?: string;\n  workflowInProgress?: boolean;\n  actions?: string[];\n  permission?: PermissionLevel;\n  referencesToAdd: Reference[];\n  referencesToRemove: string[];\n  referenceId?: string;\n  [key: string]: any;\n}\n\nexport interface Reference extends BaseDto {\n  // Can Add names here\n  referencingFormAlias?: string;\n  referencingFieldAlias?: string;\n  referencingRecordId?: string;\n  referencedFormAlias?: string;\n  referencedFieldAlias?: string;\n  referencedRecordId?: string;\n}\n\nexport interface BaseDto {\n  id?: string;\n  createdBy?: string;\n  createdOn?: Date;\n  updatedBy?: string;\n  updatedOn?: Date;\n  isSystemOwned?: boolean;\n}\n\nexport enum PermissionLevel {\n  None = 'None',\n  Read = 'Read',\n  Write = 'Write',\n  Full = 'Full',\n}\nexport enum ObjectPermissionSource {\n  RecordPermissionField = 'RecordPermissionField',\n  Form = 'Form',\n  Action = 'Action',\n  Default = 'Default',\n}\n\nexport interface SubInstancesInfoModel {\n  instance: string;\n  appId: string;\n  appSecret: string;\n}\n"],"names":["PermissionLevel","ObjectPermissionSource","UndakuSdk","instance","token","baseUrl","appId","appSecret","username","password","this","prototype","fetchToken","axios","get","headers","getHeaders","baseURL","params","response","_a","data","freshToken","getToken","post","sent","createdId","login","_c","_b","customHeaders","skipToken","defaultHeader","length","__assign","Authorization","concat","search","form","query","reportId","page","pageSize","url","searchId","searchPayload","splitColumns","recordsResponse","records","error","createRecord","record","getRecord","recordId","deleteRecord","delete","getRecordCount","checkIfRecordExist","recordLength","updateRecord","referenceId","id","put","serializeToQueryString","obj","prefix","p","str","hasOwnProperty","k","v","push","encodeURIComponent","join","getReferences","paramString","fetchSubInstances","exports"],"mappings":"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"}